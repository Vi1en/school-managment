import{j as t}from"./ui-aae23e34.js";import{r as l}from"./vendor-280e31ee.js";import{u as A,a as k,I as n,B as y,v as d,b as I}from"./index-bbee4a54.js";import{c as R,a as U}from"./router-b40667b9.js";const W=()=>{const{admissionNumber:m}=R(),p=U(),{students:x,updateStudent:D,fetchStudentById:g}=A(),{setError:L,clearError:q}=k(),[b,v]=l.useState(!1),[j,c]=l.useState(""),[S,G]=l.useState(null),[P,C]=l.useState(null),[a,N]=l.useState({admissionNumber:"",studentName:"",fatherName:"",motherName:"",dob:"",address:"",phoneNumber:"",currentClass:"",bloodGroup:"",feeDetails:{totalFee:0,amountPaid:0}}),[o,F]=l.useState({});l.useEffect(()=>{m&&g(m)},[m,g]),l.useEffect(()=>{const e=x.find(r=>r.admissionNumber===m);e&&(N({admissionNumber:e.admissionNumber,studentName:e.studentName,fatherName:e.fatherName,motherName:e.motherName,dob:e.dob,address:e.address,phoneNumber:e.phoneNumber,currentClass:e.currentClass,bloodGroup:e.bloodGroup,feeDetails:{totalFee:e.feeDetails.totalFee,amountPaid:e.feeDetails.amountPaid}}),e.photo&&C(e.photo))},[x,m]);const i=e=>{const{name:r,value:s,type:h}=e.target;if(r.startsWith("feeDetails.")){const u=r.split(".")[1];N(f=>({...f,feeDetails:{...f.feeDetails,[u]:h==="number"?s===""?0:parseFloat(s):s}}))}else N(u=>({...u,[r]:h==="number"?s===""?0:parseFloat(s):s}));o[r]&&F(u=>({...u,[r]:""}))},E=e=>{var s;const r=(s=e.target.files)==null?void 0:s[0];if(r){if(!r.type.startsWith("image/")){c("Please select an image file (JPG, PNG, JPEG)");return}if(r.size>2*1024*1024){c("File size must be less than 2MB");return}G(r),c("");const h=new FileReader;h.onload=u=>{var f;C((f=u.target)==null?void 0:f.result)},h.readAsDataURL(r)}},w=()=>{const e={};return d(a.studentName)||(e.studentName="Student Name is required"),d(a.fatherName)||(e.fatherName="Father Name is required"),d(a.motherName)||(e.motherName="Mother Name is required"),d(a.dob)||(e.dob="Date of Birth is required"),d(a.currentClass)||(e.currentClass="Current Class is required"),d(a.bloodGroup)||(e.bloodGroup="Blood Group is required"),d(a.address)||(e.address="Address is required"),d(a.phoneNumber)?I(a.phoneNumber)||(e.phoneNumber="Please enter a valid phone number"):e.phoneNumber="Phone Number is required",a.feeDetails.totalFee<=0&&(e.totalFee="Total Fee must be greater than 0"),a.feeDetails.amountPaid<0&&(e.amountPaid="Amount Paid cannot be negative"),a.feeDetails.amountPaid>a.feeDetails.totalFee&&(e.amountPaid="Amount Paid cannot be greater than Total Fee"),F(e),Object.keys(e).length===0},B=async e=>{if(e.preventDefault(),!!w()){v(!0),c(""),q();try{const r={...a,photo:S||void 0},s=await D(m,r);s.success?p("/students"):c(s.error||"Failed to update student")}catch(r){c(r.message||"Failed to update student")}finally{v(!1)}}};return t.jsx("div",{className:"max-w-4xl mx-auto space-y-6",children:t.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Edit Student"}),t.jsxs("form",{onSubmit:B,className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(n,{label:"Admission Number",name:"admissionNumber",value:a.admissionNumber,disabled:!0,className:"bg-gray-100"}),t.jsx(n,{label:"Student Name *",name:"studentName",value:a.studentName,onChange:i,error:o.studentName,required:!0}),t.jsx(n,{label:"Father Name *",name:"fatherName",value:a.fatherName,onChange:i,error:o.fatherName,required:!0}),t.jsx(n,{label:"Mother Name *",name:"motherName",value:a.motherName,onChange:i,error:o.motherName,required:!0}),t.jsx(n,{label:"Date of Birth *",name:"dob",type:"date",value:a.dob,onChange:i,error:o.dob,required:!0}),t.jsx(n,{label:"Current Class *",name:"currentClass",value:a.currentClass,onChange:i,error:o.currentClass,required:!0}),t.jsx(n,{label:"Blood Group *",name:"bloodGroup",value:a.bloodGroup,onChange:i,error:o.bloodGroup,required:!0}),t.jsx(n,{label:"Phone Number *",name:"phoneNumber",value:a.phoneNumber,onChange:i,error:o.phoneNumber,required:!0})]}),t.jsx("div",{children:t.jsx(n,{label:"Address *",name:"address",value:a.address,onChange:i,error:o.address,required:!0})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Student Photo"}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("input",{type:"file",accept:"image/*",onChange:E,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),P&&t.jsx("img",{src:P,alt:"Preview",className:"h-20 w-20 object-cover rounded-lg"})]})]}),t.jsxs("div",{className:"border-t pt-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Fee Details"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(n,{label:"Total Fee *",name:"feeDetails.totalFee",type:"number",min:"0",value:a.feeDetails.totalFee,onChange:i,error:o.totalFee,required:!0}),t.jsx(n,{label:"Amount Paid *",name:"feeDetails.amountPaid",type:"number",min:"0",value:a.feeDetails.amountPaid,onChange:i,error:o.amountPaid,required:!0})]})]}),j&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:t.jsx("div",{className:"text-sm text-red-700",children:j})}),t.jsxs("div",{className:"flex justify-end space-x-4",children:[t.jsx(y,{type:"button",variant:"secondary",onClick:()=>p("/students"),children:"Cancel"}),t.jsx(y,{type:"submit",variant:"primary",loading:b,disabled:b,children:b?"Updating...":"Update Student"})]})]})]})})};export{W as default};
